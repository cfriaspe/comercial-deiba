<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout | Comercial Deiba SpA</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Estilos -->
  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top nav-deiba">
  <div class="container">

    <a class="navbar-brand d-flex align-items-center" href="index.html">
      <img src="img/logo.png" class="logo-deiba me-2">
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
        <li class="nav-item"><a class="nav-link" href="filtros.html">Filtros</a></li>
        <li class="nav-item"><a class="nav-link" href="lubricantes.html">Lubricantes</a></li>
        <li class="nav-item"><a class="nav-link" href="repuestos.html">Repuestos</a></li>
        <li class="nav-item"><a class="nav-link active" href="#">Checkout</a></li>
      </ul>
    </div>

  </div>
</nav>

<!-- ============================================ -->
<!-- üßæ CHECKOUT FORM -->
<!-- ============================================ -->

<section class="py-5 text-white" style="margin-top:110px;">
  <div class="container">

    <h2 class="fw-bold text-center mb-4">Finalizar Pedido</h2>

    <div class="row justify-content-center">
      <div class="col-md-8">

        <!-- Resumen del pedido -->
        <div class="card bg-dark text-white mb-4">
          <div class="card-body">
            <h4 class="fw-bold mb-3">Resumen del Pedido</h4>
            <ul id="lista-resumen" class="list-group list-group-flush"></ul>

            <h4 class="fw-bold mt-3">Total: <span id="total-checkout">$ 0</span></h4>
          </div>
        </div>

        <!-- Formulario -->
        <div class="card bg-dark text-white">
          <div class="card-body">
            <h4 class="fw-bold mb-3">Datos del Cliente</h4>

            <form id="form-checkout">

              <div class="mb-3">
                <label class="form-label">Nombre completo *</label>
                <input type="text" class="form-control" id="nombre" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Empresa (opcional)</label>
                <input type="text" class="form-control" id="empresa">
              </div>

              <div class="mb-3">
                <label class="form-label">RUT (opcional)</label>
                <input type="text" class="form-control" id="rut">
              </div>

              <div class="mb-3">
                <label class="form-label">Tel√©fono de contacto *</label>
                <input type="text" class="form-control" id="telefono" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Direcci√≥n (opcional)</label>
                <input type="text" class="form-control" id="direccion">
              </div>

              <div class="mb-3">
                <label class="form-label">Notas adicionales (opcional)</label>
                <textarea class="form-control" id="notas" rows="3"></textarea>
              </div>

              <button type="submit" class="btn-deiba w-100">
                Enviar pedido por WhatsApp üì≤
              </button>

            </form>
          </div>
        </div>

      </div>
    </div>

  </div>
</section>

<!-- FOOTER -->
<footer class="footer-deiba text-center text-white py-4">
  <div class="container">
    <p class="fw-bold mb-1">Comercial Deiba SPA</p>
    <p class="mb-1">üìû Tel: +56 9 7479 0692</p>
    <p class="mb-1">‚úâÔ∏è comercialdeiba@gmail.com</p>
    <p class="mb-3">üìç Parque Isidora 908, Bodega 308B ‚Äî Pudahuel, Santiago</p>

    <div class="social-icons">
      <a href="https://www.instagram.com/comercialdeibaspa/" target="_blank" class="social-link">
        <i class="bi bi-instagram"></i>
      </a>
    </div>

    <p class="mt-3 small text-secondary">¬© 2025 Comercial Deiba SpA</p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- ============================================ -->
<!-- üß† SCRIPT CHECKOUT -->
<!-- ============================================ -->

<script>
document.addEventListener("DOMContentLoaded", function () {
  
  let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
  const resumen = document.getElementById("lista-resumen");
  const totalBox = document.getElementById("total-checkout");

  if (carrito.length === 0) {
    resumen.innerHTML = "<li class='list-group-item text-dark'>Carrito vac√≠o.</li>";
    return;
  }

  let total = 0;

  carrito.forEach(item => {
    const li = document.createElement("li");
    li.className = "list-group-item bg-dark text-white";
    li.innerHTML = `
      ${item.nombre} (x${item.cantidad})
      <span class="float-end">$ ${(
        item.precio * item.cantidad
      ).toLocaleString("es-CL")}</span>
    `;
    resumen.appendChild(li);

    total += item.precio * item.cantidad;
  });

  totalBox.innerText = "$ " + total.toLocaleString("es-CL");
});

// FORMULARIO: Enviar a WhatsApp
document.getElementById("form-checkout").addEventListener("submit", function (e) {
  e.preventDefault();

  let nombre = document.getElementById("nombre").value;
  let empresa = document.getElementById("empresa").value;
  let rut = document.getElementById("rut").value;
  let telefono = document.getElementById("telefono").value;
  let direccion = document.getElementById("direccion").value;
  let notas = document.getElementById("notas").value;

  let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
  let mensaje = `Hola, quiero realizar un pedido.%0A%0A`;

  mensaje += `üë§ *Cliente:* ${nombre}%0A`;
  if (empresa) mensaje += `üè¢ *Empresa:* ${empresa}%0A`;
  if (rut) mensaje += `üßæ *RUT:* ${rut}%0A`;
  mensaje += `üìû *Tel:* ${telefono}%0A`;
  if (direccion) mensaje += `üìç *Direcci√≥n:* ${direccion}%0A`;
  if (notas) mensaje += `üìù *Notas:* ${notas}%0A`;

  mensaje += `%0Aüì¶ *Detalle del pedido:*%0A`;

  carrito.forEach(item => {
    mensaje += `‚Ä¢ ${item.nombre} (x${item.cantidad})%0A`;
  });

  const total = carrito.reduce((s, p) => s + p.precio * p.cantidad, 0);
  mensaje += `%0Aüí∞ *Total estimado:* $${total.toLocaleString("es-CL")}%0A`;

  window.open(
    `https://wa.me/56974790692?text=${mensaje}`,
    "_blank"
  );

  localStorage.removeItem("carrito");
  location.href = "gracias.html";
});
</script>

</body>
</html>
